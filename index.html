<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIJOE</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,sans-serif;
      background:url('joey-bg.png') no-repeat center/cover fixed;
      color:#fff;
      text-shadow:0 1px 3px rgba(0,0,0,.7);
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:1rem;
    }
    #card{
      width:100%;
      max-width:420px;
      text-align:center;
      backdrop-filter:blur(4px);
      background:rgba(0,0,0,.45);
      padding:1rem;
      border-radius:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.4);
    }
    h1{margin-bottom:.5rem}
    #voice-section{margin:1rem auto;display:flex;justify-content:center;gap:.5rem}
    #micBtn{
      font-size:1.25rem;padding:.5rem 1rem;border:none;border-radius:9999px;cursor:pointer;
      background:#2b6cb0;color:#fff;box-shadow:0 2px 6px rgba(0,0,0,.3);
    }
    #voiceSelect{padding:.4rem}
    #response{margin:1rem auto;min-height:2.5rem;padding:.5rem;border:1px solid rgba(255,255,255,.3);
      border-radius:8px;background:rgba(0,0,0,.25);}
    #actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.5rem;margin-top:1rem}
    .action{padding:.75rem;border:none;border-radius:12px;background:#2b6cb0;color:#fff;font-size:.8rem;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3);}
    .action:active{transform:scale(.97)}
    footer{margin-top:1rem;font-size:.75rem;color:#ddd}
  </style>
</head>
<body>
  <div id="card">
    <h1>AIJOE</h1>
    <section id="voice-section">
      <button id="micBtn">ðŸŽ¤ Talk</button>
      <select id="voiceSelect"></select>
    </section>
    <div id="response">Ready.</div>
    <div id="actions">
      <button class="action" data-action="gps">GPS</button>
      <button class="action" data-action="bible">Bible Verse</button>
      <button class="action" data-action="sos">Mental Help</button>
      <button class="action" data-action="music">Music</button>
      <button class="action" data-action="joke">Joke</button>
      <button class="action" data-action="weather">Weather</button>
      <button class="action" data-action="secret">Secret Help</button>
    </div>
    <footer>AIJOE â€¢ Your friendly AI assistant</footer>
  </div>

<script>
const voiceSelect=document.getElementById('voiceSelect');
function populateVoices(){const v=speechSynthesis.getVoices();voiceSelect.innerHTML=v.map((x,i)=>`<option value='${i}'>${x.name} (${x.lang})</option>`).join('');}
populateVoices();speechSynthesis.onvoiceschanged=populateVoices;

function speak(text){const u=new SpeechSynthesisUtterance(text);const v=speechSynthesis.getVoices();if(v[voiceSelect.value])u.voice=v[voiceSelect.value];speechSynthesis.speak(u);}
function display(msg){document.getElementById('response').innerText=msg;}

const Rec=window.SpeechRecognition||window.webkitSpeechRecognition;let rec;
if(Rec){rec=new Rec();rec.lang='en-US';rec.interimResults=false;
rec.onresult=e=>askAI(e.results[0][0].transcript);rec.onerror=e=>display('Voice error: '+e.error);}
else{document.getElementById('micBtn').disabled=true;display('Speech rec not supported');}

document.getElementById('micBtn').addEventListener('click',()=>{if(rec){rec.start();display('Listening...');}});

async function askAI(prompt){display('Thinking...');try{const r=await fetch('/.netlify/functions/askAI',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt})});const d=await r.json();display(d.answer);speak(d.answer);}catch(e){display('AI error')}})

// Button actions
async function getBibleVerse(){
  try{
    const r=await fetch('https://labs.bible.org/api/?passage=random&type=json');
    const d=await r.json();
    return d[0].bookname+' '+d[0].chapter+':'+d[0].verse+' - '+d[0].text;
  }catch(e){return 'Sorry, could not fetch verse.'}
}

async function getWeather(){
  return new Promise((res,rej)=>{
    navigator.geolocation.getCurrentPosition(async pos=>{
      const {latitude,longitude}=pos.coords;
      try{
        const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m`);
        const d=await w.json();
        res('Current temp is '+d.current.temperature_2m+'Â°C');
      }catch(e){res('Weather fetch error')}
    },()=>res('GPS disabled'));
  });
}

document.getElementById('actions').addEventListener('click',async e=>{
  if(!e.target.classList.contains('action'))return;
  const act=e.target.dataset.action;
  if(act==='gps'){
    navigator.geolocation.getCurrentPosition(p=>{
      const msg='Latitude '+p.coords.latitude.toFixed(3)+', Longitude '+p.coords.longitude.toFixed(3);
      display(msg);speak(msg);
    },()=>{display('Please enable GPS');});
  }else if(act==='bible'){
    display('Fetching verse...');const v=await getBibleVerse();display(v);speak(v);
  }else if(act==='sos'){
    const msg='If you need immediate help, call 988. You are not alone and I care about you.';
    display(msg);speak(msg);
  }else if(act==='music'){
    window.open('https://www.youtube.com/results?search_query=uplifting+music+no+ads','_blank');
    display('Opening YouTube for music');speak('Enjoy the music!');
  }else if(act==='joke'){
    askAI('Tell me a short, funny joke.');
  }else if(act==='weather'){
    display('Fetching weather...');const w=await getWeather();display(w);speak(w);
  }else if(act==='secret'){
    askAI('I need secret help.');
  }
});
</script>
</body></html>