
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AIJOE</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d1117"/>
  <style>
    body {
      margin: 0; background: #0d1117; color: white;
      font-family: Arial; text-align: center; padding: 20px;
    }
    h1 { font-size: 2em; margin-bottom: 10px; }
    img#joey { width: 110px; border-radius: 18px; margin-bottom: 10px; }
    button {
      background: #1e90ff; color: white; border: none; padding: 12px 18px;
      margin: 10px; border-radius: 12px; font-size: 1em; cursor: pointer;
    }
    .log { margin-top: 10px; color: #a8d1ff; }
    .mood { margin-top: 12px; font-size: 0.95em; color: #ffd77a; }
  </style>
</head>
<body>
  <h1>ğŸ¾ AIJOE</h1>
  <img id="joey" src="joey-avatar.png" alt="Joey Icon"/>
  <div class="mood" id="moodDisplay">Mood: Happy ğŸ˜Š</div>
  <button id="micBtn">ğŸ¤ Talk to Joey</button>
  <button onclick="changeMood()">ğŸ­ Change Mood</button>
  <div class="log" id="log">Say â€œwhatâ€™s the weatherâ€ or â€œadd milk to my listâ€</div>

  <script>
    const synth = window.speechSynthesis;
    const log = document.getElementById("log");
    const moodDisplay = document.getElementById("moodDisplay");
    let todos = JSON.parse(localStorage.getItem('aijoe_todos') || "[]");
    let mood = localStorage.getItem('aijoe_mood') || "Happy";

    const moods = {
      "Happy": "ğŸ˜Š",
      "Helpful": "ğŸ¤–",
      "Sleepy": "ğŸ˜´",
      "Funny": "ğŸ˜‚"
    };

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = synth.getVoices().find(v => v.lang.startsWith('en')) || null;
      synth.speak(utter);
    }

    function updateMood() {
      moodDisplay.textContent = `Mood: ${mood} ${moods[mood]}`;
      localStorage.setItem('aijoe_mood', mood);
    }

    function changeMood() {
      const keys = Object.keys(moods);
      const index = (keys.indexOf(mood) + 1) % keys.length;
      mood = keys[index];
      updateMood();
      speak(`Mood changed to ${mood}`);
    }

    function handleCommand(text) {
      const cmd = text.toLowerCase();
      log.textContent = "You said: " + cmd;

      if (cmd.includes("weather")) {
        getWeather();
      } else if (cmd.includes("add") && cmd.includes("list")) {
        const item = cmd.split("add")[1].split("to")[0].trim();
        if (item) {
          todos.push(item);
          localStorage.setItem('aijoe_todos', JSON.stringify(todos));
          speak(`${item} added to your list.`);
        }
      } else if (cmd.includes("show") && cmd.includes("list")) {
        todos.length ? speak("Your list: " + todos.join(", ")) : speak("Your list is empty.");
      } else if (cmd.includes("mood")) {
        speak(`My current mood is ${mood}`);
      } else {
        speak(`You said: ${cmd}`);
      }
    }

    function getWeather() {
      const key = "demo"; // placeholder key
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${key}&units=imperial`)
          .then(res => res.json())
          .then(data => {
            const temp = Math.round(data.main.temp);
            const desc = data.weather[0].description;
            speak(`It's ${temp} degrees and ${desc}`);
          }).catch(() => {
            speak("Unable to get weather right now.");
          });
      }, () => speak("Can't get your location."));
    }

    document.getElementById("micBtn").onclick = () => {
      const recog = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recog.lang = 'en-US';
      recog.interimResults = false;
      recog.maxAlternatives = 1;
      recog.start();
      log.textContent = "ğŸ™ï¸ Listening...";
      recog.onresult = e => handleCommand(e.results[0][0].transcript);
      recog.onerror = e => {
        log.textContent = "Error: " + e.error;
        speak("Sorry, I didn't catch that.");
      };
    };

    window.onload = () => updateMood();
  </script>
</body>
</html>
