const voiceSelect=document.getElementById('voiceSelect');function populateVoices(){const v=speechSynthesis.getVoices();voiceSelect.innerHTML=v.map((x,i)=>`<option value='${i}'>${x.name} (${x.lang})</option>`).join('');}populateVoices();speechSynthesis.onvoiceschanged=populateVoices;const Rec=window.SpeechRecognition||window.webkitSpeechRecognition;let rec;if(Rec){rec=new Rec();rec.lang='en-US';rec.interimResults=false;rec.onresult=e=>askAI(e.results[0][0].transcript);rec.onerror=e=>displayResponse('Voice error: '+e.error);}else{document.getElementById('micBtn').disabled=true;displayResponse('Speech Recognition not supported.');}document.getElementById('micBtn').addEventListener('click',()=>{if(rec){rec.start();displayResponse('Listening...');}});function speak(t){const u=new SpeechSynthesisUtterance(t);const vs=speechSynthesis.getVoices();if(vs[voiceSelect.value])u.voice=vs[voiceSelect.value];speechSynthesis.speak(u);}function displayResponse(m){document.getElementById('response').innerText=m;}async function askAI(p){displayResponse('Thinking...');try{const res=await fetch('/.netlify/functions/askAI',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:p})});const data=await res.json();displayResponse(data.answer);speak(data.answer);}catch(err){displayResponse('Error contacting AI.');}}document.querySelectorAll('.action').forEach(b=>b.addEventListener('click',()=>askAI('Help with '+b.dataset.action)));