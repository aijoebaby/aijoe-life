const voiceSelect=document.getElementById('voiceSelect');function populateVoices(){const v=speechSynthesis.getVoices();voiceSelect.innerHTML=v.map((s,i)=>`<option value='${i}'>${s.name} (${s.lang})</option>`).join('');}populateVoices();speechSynthesis.onvoiceschanged=populateVoices;const R=window.SpeechRecognition||window.webkitSpeechRecognition;let rec;if(R){rec=new R();rec.lang='en-US';rec.interimResults=false;rec.onresult=e=>askAI(e.results[0][0].transcript);rec.onerror=e=>displayResponse('Voice error: '+e.error);}else{document.getElementById('micBtn').disabled=true;displayResponse('Speech Recognition not supported.');}document.getElementById('micBtn').addEventListener('click',()=>{if(rec){rec.start();displayResponse('Listening...');}});function speak(t){const u=new SpeechSynthesisUtterance(t);const v=speechSynthesis.getVoices();const idx=voiceSelect.value;if(v[idx])u.voice=v[idx];speechSynthesis.speak(u);}function displayResponse(m){document.getElementById('response').innerText=m;}async function askAI(q){displayResponse('Thinking...');try{const res=await fetch('/.netlify/functions/askAI',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:q})});const data=await res.json();const a=data.answer||'Sorry, I cannot answer that.';displayResponse(a);speak(a);}catch(err){displayResponse('Error contacting AI.');}}document.querySelectorAll('.action').forEach(b=>b.addEventListener('click',()=>askAI('Help with '+b.dataset.action)));